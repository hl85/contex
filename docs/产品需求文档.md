# 产品需求文档 (Product Requirements Document)

**项目名称：** Contex (Container + Context, 隐喻cortex)

## 1. 简介 (Introduction)

### 1.1 背景与机会

当前 AI Agent 市场两极分化：

* **云端 Agent (如 Manus):** 体验好，但无法直接访问用户本地文件，存在隐私顾虑。
* **本地脚本 (Local Script):** 能操作本地文件，但环境配置极难（Python/Cuda 依赖地狱），且难以实现合规的远程控制。

**Contex** 旨在填补这一空白：提供一个**开箱即用、环境隔离、不仅能处理本地数据，还能通过微信/Telegram 远程指挥**的个人 AI 生产力底座。

### 1.2 产品愿景

让每个人都拥有一个运行在本地、绝对私密、但随时待命的“数字化分身”。

### 1.3 成功指标 (Success Metrics)

* **安装成功率：** > 95% (用户无需手动处理 Docker 报错)。
* **冷启动时间：** < 10秒 (点击图标到 Agent 就绪)。
* **远程连接稳定性：** 99.9% (微信指令不丢失)。
* **任务闭环率：** > 80% (用户发起的任务能最终交付结果)。

---

## 2. 用户画像 (User Personas)

| ID | 角色 | 典型特征 | 核心诉求 |
| --- | --- | --- | --- |
| **P1** | **Sarah (数据分析师)** | 处理敏感财报，Excel 重度用户，不懂 Linux。 | **隐私与安全**。希望 AI 能直接读取桌面上的 Excel 并画图，且数据不上传云端。 |
| **P2** | **Alex (全栈开发者)** | 极客，喜欢折腾新技术，厌恶复杂的环境配置。 | **环境一致性**。希望有一个干净的、随时可重置的 Dev Container，且能通过 API 控制。 |
| **P3** | **David (家长)** | 经常在外出差，关心孩子学习。 | **远程控制**。希望在地铁上用微信就能生成一个数学复习网页发给家里的孩子。 |

---

## 3. 功能需求规格 (Functional Requirements)

### 3.1 模块 A: 桌面端体验 (Desktop Wrapper)

*优先级：P0 (最高)*

| 需求 ID | 功能名称 | 详细描述 | 验收标准 |
| --- | --- | --- | --- |
| **FR-A01** | **一键环境初始化** | 应用启动时自动检测 Docker。若未安装，提供内置安装包或引导页；若镜像缺失，自动拉取。 | 用户双击图标，进度条跑完后，绿灯亮起，显示“系统就绪”。全程无命令行。 |
| **FR-A02** | **仪表盘 (Dashboard)** | 展示 CPU/内存占用、容器运行状态、Sidecar 连接状态。 | 实时更新数据（刷新率 1s）。 |
| **FR-A03** | **技能商店 (Skills)** | 提供预置 Agent 模板（晨读、编程、分析）的开关。 | 用户勾选“晨读助手”后，自动加载对应 Skill 配置。 |
| **FR-A04** | **配置管理** | 可视化配置 API Key (OpenAI/DeepSeek)、挂载目录白名单。 | 敏感 Key 需掩码显示；目录选择需调用原生文件选择器。 |

### 3.2 模块 B: 执行核心 (The Brain - Container)

*优先级：P0 (最高)*

| 需求 ID | 功能名称 | 详细描述 | 验收标准 |
| --- | --- | --- | --- |
| **FR-B01** | **预置工具链** | 镜像内必须预装：Python 3.11+, Node LTS, Supervisor, Git, Playwright, Code Server。 | 启动 Python 脚本能正常运行；能通过 Supervisor 管理后台进程。 |
| **FR-B02** | **持久化工作区** | 容器内的 `/workspace` (代码) 和 `~/.local` (用户依赖) 必须映射到宿主机。 | 容器重启后，之前安装的 pip 包和生成的代码文件不丢失。 |
| **FR-B03** | **MCP 客户端** | 容器启动时自动连接宿主机 Sidecar 的 MCP Server。 | Agent 能通过 `list_tools` 获取到宿主机能力列表。 |

### 3.3 模块 C: 神经桥接 (Sidecar / MCP Host)

*优先级：P0 (最高)*

| 需求 ID | 功能名称 | 详细描述 | 验收标准 |
| --- | --- | --- | --- |
| **FR-C01** | **文件系统访问** | 提供 `fs_read`, `fs_write` 能力。必须校验白名单。 | 尝试读取非白名单目录（如 `/etc/passwd`）应返回 Permission Denied。 |
| **FR-C02** | **应用控制** | 提供 `open_app`, `open_url` 能力。 | 调用接口后，宿主机 Chrome 浏览器应弹出指定网页。 |
| **FR-C03** | **内网穿透** | 提供 `expose_port` 能力，将容器端口映射为临时公网 URL。 | 返回的 URL 在外网（如 4G 网络）能访问容器内的网页。 |

### 3.4 模块 D: 远程接入 (Remote Access)

*优先级：P1 (核心)*

| 需求 ID | 功能名称 | 详细描述 | 验收标准 |
| --- | --- | --- | --- |
| **FR-D01** | **设备绑定** | 桌面端生成二维码，微信小程序扫码绑定。 | 扫码后，小程序显示“已连接 [设备名]”。 |
| **FR-D02** | **指令下发** | 支持语音转文字、文本输入。 | 发送“生成日报”，桌面端仪表盘应显示“正在接收远程指令”状态。 |
| **FR-D03** | **结果渲染** | 支持 Markdown 渲染、图片预览、Webview 卡片。 | 生成的图表能在微信内直接预览，点击链接能打开 Webview。 |

---

## 4. 非功能性需求 (Non-Functional Requirements)

### 4.1 性能要求

* **资源限制：** 默认配置下，Docker 内存占用不超过 4GB，CPU 占用不超过 50%（空闲时 < 5%）。
* **响应延迟：** 本地任务响应 < 2s；远程指令（微信到 Sidecar）传输延迟 < 1s。

### 4.2 安全性要求 (Security)

* **沙箱机制：** 默认禁止容器以 `--privileged` 模式启动。
* **鉴权：** Sidecar 接口拒绝所有未携带 `SessionToken` 的请求。
* **数据主权：** 明确承诺除用户主动发送至微信的内容外，不主动上传任何本地文件。

### 4.3 兼容性

* **操作系统：** macOS 14+ (Apple Silicon 优先), Windows 11 (WSL2)。
* **Docker 版本：** 兼容 Docker Desktop 4.x 及以上。

---

## 5. 用户体验设计 (UX Guidelines)

### 5.1 "零终端" 原则 (Zero Terminal Policy)

* 普通用户在使用过程中，**严禁**出现黑色命令行窗口。
* 所有的 Docker 拉取、启动、报错，必须转化为人性化的 GUI 提示（如进度条、Toast 提示）。

### 5.2 状态可见性

* 当 Agent 正在进行长时间任务（如爬取网页）时，微信端和桌面端都必须有明确的“思考中/执行中”动效，避免用户以为死机。

### 5.3 错误处理

* **场景：** 微信发指令，但家里的电脑休眠了。
* **反馈：** 小程序应立即提示“设备离线”，而不是一直转圈。

---

## 6. 发布计划 (Release Roadmap)

| 阶段 | 版本 | 核心目标 | 关键交付物 | 预计时间 |
| --- | --- | --- | --- | --- |
| **Phase 1** | **v0.5 (Alpha)** | **本地闭环** | macOS 安装包，本地 Docker 启动，本地数据分析 Skill。 | Month 1 |
| **Phase 2** | **v1.0 (MVP)** | **远程联通** | Windows 支持，Sidecar 穿透功能，微信小程序上线。 | Month 2 |
| **Phase 3** | **v1.5** | **生态扩展** | MCP 插件支持（允许用户配置 Linear/Notion 等第三方 MCP）。 | Month 4 |

---

## 7. 附录：核心交互流程图 (关键路径)

*(此处引用技术文档中的 Mermaid 流程图，侧重于业务流转)*

1. **晨读场景：** 定时触发 -> 爬虫(容器) -> 总结(容器) -> 推送(Sidecar) -> 微信/Telegram。
2. **编程场景：** 远程指令 -> 代码生成(容器) -> 启动服务(容器) -> 穿透映射(Sidecar) -> 返回链接 -> 微信/Telegram 预览。
